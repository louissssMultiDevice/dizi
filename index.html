<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DIZI Music Official</title>
  <link rel="stylesheet" href="public/styles.css">
</head>
<body>
  <div class="container">
    <h1 class="logo">DIZI</h1>
    <p class="subtitle">Grub Musik Official ‚Äì ‚ÄúTerima Kasih‚Äù</p>

    <canvas id="visualizer"></canvas>

    <audio id="audio" src="public/Terimakasih.mp3"></audio>

    <div class="controls">
      <button id="prev" class="btn">‚èÆÔ∏è</button>
      <button id="play" class="btn play">‚ñ∂Ô∏è</button>
      <button id="next" class="btn">‚è≠Ô∏è</button>
    </div>

    <div id="lyricsBox" class="lyrics">‚ÄúTerima kasih...‚Äù</div>

    <div class="comments">
      <h2>üí¨ Komentar Fans</h2>
      <form id="commentForm">
        <input type="text" id="name" placeholder="Nama kamu..." required />
        <textarea id="message" placeholder="Tulis komentar..." required></textarea>
        <button type="submit">Kirim</button>
      </form>
      <div id="commentList"></div>
    </div>
  </div>

  <script type="module">
    const audio = document.getElementById("audio");
    const playBtn = document.getElementById("play");
    const canvas = document.getElementById("visualizer");
    const ctx = canvas.getContext("2d");
    canvas.width = canvas.offsetWidth;
    canvas.height = canvas.offsetHeight;

    const audioCtx = new AudioContext();
    const src = audioCtx.createMediaElementSource(audio);
    const analyser = audioCtx.createAnalyser();
    src.connect(analyser);
    analyser.connect(audioCtx.destination);
    analyser.fftSize = 256;

    const bufferLength = analyser.frequencyBinCount;
    const dataArray = new Uint8Array(bufferLength);

    function draw() {
      requestAnimationFrame(draw);
      analyser.getByteFrequencyData(dataArray);
      ctx.fillStyle = "rgba(0,0,0,0.2)";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      const barWidth = (canvas.width / bufferLength) * 2.5;
      let x = 0;
      for (let i = 0; i < bufferLength; i++) {
        const barHeight = dataArray[i] * 1.2;
        ctx.fillStyle = `hsl(${260 + i * 1.2}, 100%, 60%)`;
        ctx.fillRect(x, canvas.height - barHeight, barWidth, barHeight);
        x += barWidth + 1;
      }
    }

    playBtn.onclick = async () => {
      await audioCtx.resume();
      if (audio.paused) {
        audio.play();
        playBtn.classList.add("active");
        playBtn.textContent = "‚è∏Ô∏è";
        draw();
      } else {
        audio.pause();
        playBtn.classList.remove("active");
        playBtn.textContent = "‚ñ∂Ô∏è";
      }
    };

    // Lirik bergerak
    const lyrics = [
"Sumpah, aku ingin bertemu kamu",
"Ku ingin engkau ada di sampingku",
"Ku ingin engkau tahu betapa rindunya hati kecilku",
"Ku ingin engkau ada di setiap hari-hariku",
"Kenapa? Mengapa? Oh kenapa? Mengapa begini?",
"Perasaan rindu ini selalu menghampiri, uo-oo",
"Selalu aku yang ada saat kau bercerita",
"Mengapa kini kau pergi begitu saja? uoo-oooo",
"Kenapa dia lagi dia lagi dia lagi yang aku cari?",
"Kenapa dia lagi dia lagi yang aku cintai?",
"Ku ingin bersamamu hingga nanti kita tua bersama",
"Ku ingin kita bersama hingga selama-lamanya",
"Semua indah pada waktunya",
"Pada akhirnya Semua hanya angan-angan ku sajaaa",
"kita takkan pernah bersama, uo-oo",
"Sayangnya semua tak berjalan, sedangkan bertahan bukan satu pilihan",
"Sayangnya mengapa kita berjumpa",
"Padahal kita tak kan ke tujuan yang sama",
"Pantaskah aku menyimpan rasa rindu yang begitu dalam?",
"Lantas mengapa ku masih menunggumu hingga matahari tenggelam?",
"Simpanlah kau dalam mimpi indahku",
"Sebab kau tak datang dalam hidupku",
"Lewatkah aku di sela pikiranmu?",
"Aku rindu, sangat rindu, tapi tak bisa bertemu",
"Terima kasih atas segala rasa",
"Pada masa itu aku sangat bahagia",
"Selalu tertawa, walau kini ku bertahan dengan air mata",
"Mendengar cerita, kau kini bahagia",
"Ku hanya bisa tersenyum mendengarnya",
"Memendam kecewa, kau senang di sana",
"Terima kasih‚Ä¶",
‚ô™",
"Terima kasih...",
"‚ô™",
"Terima kasih..."
    ];
    let i = 0;
    setInterval(() => {
      document.getElementById("lyricsBox").innerText = lyrics[i];
      i = (i + 1) % lyrics.length;
    }, 5000);

    // Komentar sistem
    const form = document.getElementById("commentForm");
    const list = document.getElementById("commentList");

    async function loadComments() {
      const res = await fetch("/comments");
      const data = await res.json();
      list.innerHTML = data.map(c => `
        <div class="comment">
          <div class="avatar">${c.name.charAt(0).toUpperCase()}</div>
          <div class="content">
            <strong>${c.name}</strong>
            <p>${c.message}</p>
          </div>
        </div>`).join("");
    }

    form.onsubmit = async e => {
      e.preventDefault();
      const name = document.getElementById("name").value;
      const message = document.getElementById("message").value;
      await fetch("/comments", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name, message })
      });
      form.reset();
      loadComments();
    };

    loadComments();
  </script>
</body>
</html>
